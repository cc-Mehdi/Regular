@page
@using Datalayer.Models
@using Datalayer.Repository.IRepository
@model Regular.Pages.Customer.UserPanelModel
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Regular - مدیریت</title>
    <!-- Bootstrap Styles v5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/src/CSS/userPanel.css" />
    <link rel="stylesheet" href="/src/global/main.css" />
    <!-- WebSite Icon -->
    <link rel="shortcut icon" href="/src/media/Logo/regular-favicon-color.png" type="image/x-icon" />
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <!-- HC-Web-Module Styles -->
    <link rel="stylesheet" href="/src/CSS/HC-Web-Module/HC-Styles.css" />
    <!-- Toastr Styles -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
</head>


<body dir="rtl" class="overflow-x-hidden overflow-y-auto bc-darkBlue">
    <div class="container-fluid">
        <header></header>

        <main>
            <div class="container-fluid p-0 d-flex align-items-center justify-content-center">
                <!-- OffCanvas button -->
                <button id="btnShowMenuToggler" onclick="ShowoffcanvasMenu()"
                        class="offcanvas-hoverButton btn m-2 position-fixed top-0 end-0 z-3 border-0 visually-hidden text-white hc-fs-title2"
                        type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling"
                        aria-controls="offcanvasScrolling">
                    <i class="bi bi-menu-app" data-bs-toggle="tooltip" data-bs-title="منو" data-bs-placement="bottom"></i>
                </button>

                <!-- OffCanvas menu -->
                <div id="offcanvasMenu" class="offcanvas offcanvas-end rounded-start-5" data-bs-scroll="true"
                     data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel"
                     style="background-color: #f2f2f2">
                    <!-- offcanvas header -->
                    <div class="offcanvas-header d-flex justify-content-between">
                        <a href="/"
                           class="offcanvas-title text-decoration-none text-black d-flex justify-content-center align-items-center"
                           id="offcanvasExampleLabel">
                            <img src="/src/media/Logo/regular-favicon-color.png" width="50px" height="50px" alt="hyper cloud logo"
                                 class="rounded-circle" style="box-shadow: 0 0 10px white" />
                            <span class="app-brand-text demo menu-text text-black fs-4 fw-bold me-2"
                                  style="text-shadow: 0 0 1px var(--c-primary)">Regular</span>
                        </a>
                        <button type="button" onclick="HideoffcanvasMenu()" class="offcanvas-hoverButton btn border-0"
                                data-bs-dismiss="offcanvas">
                            <i class="bi bi-x-circle fs-2 tc-primary" data-bs-toggle="tooltip" data-bs-title="بستن منو"
                               data-bs-placement="bottom"></i>
                        </button>
                    </div>
                    <!-- offcanvas body -->
                    <div class="offcanvas-body overflow-x-hidden px-3 m-0 d-flex flex-column align-items-center justify-content-start w-100">
                        <!-- Menu buttons -->
                        <div class="w-100 d-flex justify-content-start align-items-center border border-bottom-1 border-top-0 border-start-0 border-end-0 pb-4">
                            <button class="btn btn-dark dropdown-toggle rounded-0 rounded-end-3 bc-darkBlue w-75 border border-0 py-2"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                @{
                                    if (Model.OrganizationsList.Count > 0)
                                    {
                                        <span id="ddlOrganization" data-id="@Model.OrganizationsList[0].Id">@Model.OrganizationsList[0].Title</span>
                                    }
                                    else
                                    {
                                        <span>سازمان ها</span>
                                    }
                                }
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end bc-darkBlue w-75 py-0" id="organizationsList">
                                @{
                                    foreach (var item in Model.OrganizationsList)
                                    {
                                        <li>
                                            <a class="dropdown-item text-end text-white py-3" onclick="UpdateProjectsByOrganizationId('@item.Id', '@item.Title')">@item.Title</a>
                                        </li>
                                    }
                                }
                            </ul>
                            <button data-bs-toggle="modal" data-bs-target="#newOrganizationModal" class="btnNewOrganization rounded-start-3 py-2 px-3 border-bottom-0 border-top-0 border-start-0 border-end-3 border-white bc-primary text-white">
                                <i class="bi bi-plus-circle"></i>
                            </button>
                        </div>

                        <!-- Menu Items List -->
                        <div class="mt-3 w-100">
                            <ul class="list-unstyled w-100 m-0 p-0 d-flex flex-column justify-content-start">
                                <a onclick="UpdateProjectsByOrganizationId()">
                                <li id="userPanel-menuItem-active" class="userPanel-menuItem-active userPanel-menuItem py-3 px-5 fs-5 fw-bold w-100 rounded-start-4">
                                    پروژه ها
                                </li>
                                </a>
                                <a onclick="UpdateTasksByOrganizationId()">
                                <li class="userPanel-menuItem py-3 px-5 fs-5 fw-bold w-100 rounded-start-4">
                                    همه وظایف
                                </li>
                                </a>
                                <li class="userPanel-menuItem py-3 px-5 fs-5 fw-bold w-100 rounded-start-4">
                                    همکاران
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- End OffCanvas menu -->

                <div id="menuBox-Temp" class="col-lg-4 col-xxl-4" style="height: 100vh"></div>

                <!-- Main -->
                <div id="mainBox" class="col-lg-8 col-xxl-6 d-flex justify-content-start align-items-start p-3"
                     style="height: 95vh">
                    <div class="row w-100 d-flex justify-content-center">
                        <!-- Search Box -->
                        <div class="row">
                            <input type="search" onkeyup="UpdateProjectsByFilter(this.value)" class="form-control border-0 tc-lightBlue fs-5 py-2" placeholder="جستجو" />
                        </div>

                        <div id="itemsList" class="row w-100 d-flex justify-content-center">
                            @foreach (var project in Model.ProjectsList)
                            {
                                <!-- item card -->
                                <div class="col-lg-4 col-md-4 col-sm-6 p-3">
                                    <div class="userPanel-itemCard hc-box bc-primary">
                                        <a href="#">
                                            <div class="d-flex flex-column justify-content-center align-items-center">
                                                <!-- item card image -->
                                                <img src="/src/media/Logo/regular-favicon-color.png" alt="item card image" width="65px"
                                                     height="65px" />
                                                <!-- item card title -->
                                                <h3 class="hc-fs-paragraph2 my-2">@project.Title</h3>
                                                <!-- item card tags -->
                                                <div class="itemCard-tagBox d-flex flex-column justify-content-center align-items-center py-3">
                                                    <span class="itemCard-tag p-1 px-3 bc-darkBlue rounded-3 text-white hc-fs-span3 my-1">
                                                        انجام شده : @project.TasksStatusPercent%
                                                    </span>
                                                    <span class="itemCard-tag p-1 px-3 bc-darkBlue rounded-3 text-white hc-fs-span3 my-1">
                                                        تعداد وظایف : @project.TasksCount
                                                    </span>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                                <!-- end item card -->
                            }

                            <!-- item card (new button) -->
                            <div class="col-lg-4 col-md-4 col-md-4 col-sm-6 p-3">
                                <div class="userPanel-itemCard hc-box bc-primary" data-bs-toggle="modal"
                                     data-bs-target="#newProjectModal">
                                    <div class="d-flex flex-column justify-content-center align-items-center h-100">
                                        <!-- item card icon -->
                                        <i class="fa-solid fa-plus text-white hc-fs-title1" aria-hidden="true"></i>
                                        <!-- item card title -->
                                        <h3 class="hc-fs-paragraph2 my-2 text-center">
                                            افزودن پروژه جدید
                                        </h3>
                                    </div>
                                </div>
                            </div>
                            <!-- end item card (new button) -->

                        </div>




                    </div>
                </div>
                <!-- End Main -->
            </div>
        </main>

        <footer></footer>
    </div>


    <!-- Add New Project Modal -->
    <div class="modal fade" id="newProjectModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
         aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header w-100 d-flex justify-content-between bc-lightCyan">
                    <h1 class="modal-title fs-5 text-black" id="staticBackdropLabel">
                        افزودن پروژه
                    </h1>
                    <button type="button" class="btn-close mx-0" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body bc-darkBlue text-white">
                    <!-- Add new project modal body -->
                    <form id="projectForm" method="post" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="formFile" class="form-label">عنوان پروژه</label>
                            <input type="text" class="form-control border-0 tc-lightBlue fs-5 py-2 mb-3" name="Title"
                                   placeholder="تکمیل طراحی اولیه" />
                            <span class="text-danger" asp-validation-for="@Model.Projects.Title"></span>
                        </div>

                        <div class="mb-3">
                            <label for="formEmployees" class="form-label">همکاران</label>
                            <a class="btn bc-primary rounded-bottom-0 d-block" data-bs-toggle="collapse" href="#multiCollapseExample1" role="button" aria-expanded="false" aria-controls="multiCollapseExample1">انتخاب همکار</a>
                            <div class="row mb-3">
                                <div class="col">
                                    <div class="collapse multi-collapse" id="multiCollapseExample1">
                                        <div class="card card-body bc-primary tc-lightCyan rounded-top-0">
                                            @foreach (var item in Model.EmployeesList)
                                            {
                                                <div class="form-check form-check-reverse">
                                                    <input class="form-check-input bc-secondary hc-fs-paragraph2" type="checkbox" value="@item.Id" name="Employees" id="employeeCheck@item.Id">
                                                    <label class="form-check-label w-100 hc-fs-span1" for="employeeCheck@item.Id">
                                                        @item.FullName
                                                    </label>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="mb-3">
                            <label for="formFile" class="form-label">لوگو پروژه</label>
                            <input class="form-control border-0 tc-lightBlue fs-5 py-2" type="file" id="formFile" />
                        </div>

                        <div class="modal-footer bc-lightCyan">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                انصراف
                            </button>
                            <button type="submit" class="btn btn-success" id="bindProjects">
                                افزودن پروژه جدید
                            </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Add New Organization Modal -->
    <div class="modal fade" id="newOrganizationModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
         aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header w-100 d-flex justify-content-between bc-lightCyan">
                    <h1 class="modal-title fs-5 text-black" id="staticBackdropLabel">
                        افزودن سازمان
                    </h1>
                    <button type="button" class="btn-close mx-0" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body bc-darkBlue text-white">
                    <!-- Add new organization modal body -->
                    <form id="organizationForm" method="post" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="formFile" class="form-label">تصویر</label>
                            <input class="form-control border-0 tc-lightBlue fs-5 py-2" type="file" id="formFile" name="ImageName" />
                        </div>

                        <div class="mb-3">
                            <label for="formTitle" class="form-label">عنوان سازمان</label>
                            <input type="text" class="form-control border-0 tc-lightBlue fs-5 py-2 mb-3" id="formTitle" name="Title" placeholder="تکمیل طراحی اولیه" />
                            <span class="text-danger" asp-validation-for="@Model.Organization.Title"></span>
                        </div>

                        <div class="mb-3">
                            <label for="formEmployees" class="form-label">همکاران</label>
                            <a class="btn bc-primary rounded-bottom-0 d-block" data-bs-toggle="collapse" href="#multiCollapseExample1" role="button" aria-expanded="false" aria-controls="multiCollapseExample1">انتخاب همکار</a>
                            <div class="row mb-3">
                                <div class="col">
                                    <div class="collapse multi-collapse" id="multiCollapseExample1">
                                        <div class="card card-body bc-primary tc-lightCyan rounded-top-0">
                                            @foreach (var item in Model.EmployeesList)
                                            {
                                                <div class="form-check form-check-reverse">
                                                    <input class="form-check-input bc-secondary hc-fs-paragraph2" type="checkbox" value="@item.Id" name="Employees" id="employeeCheck@item.Id">
                                                    <label class="form-check-label w-100 hc-fs-span1" for="employeeCheck@item.Id">
                                                        @item.FullName
                                                    </label>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="modal-footer bc-lightCyan">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                انصراف
                            </button>
                            <button type="submit" class="btn btn-success" id="bindOrganizations">
                                افزودن سازمان جدید
                            </button>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>

    <!-- Add New Tasks Modal -->
    <!-- Add New Tasks Modal -->
    <div class="modal fade" id="newTaskModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header w-100 d-flex justify-content-between bc-lightCyan">
                    <h1 class="modal-title fs-5 text-black" id="staticBackdropLabel">
                        افزودن وظیفه
                    </h1>
                    <button type="button" class="btn-close mx-0" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body bc-darkBlue text-white">
                    <!-- Add new task modal body -->
                    <form id="taskForm" method="post" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="taskTitle" class="form-label">عنوان وظیفه</label>
                            <input type="text" class="form-control border-0 tc-lightBlue fs-5 py-2 mb-3" name="title" id="taskTitle" placeholder="طراحی بنر">
                            <span class="text-danger" asp-validation-for="@Model.Tasks.Title"></span>
                        </div>

                        <div class="mb-3">
                            <label for="formPriority" class="form-label">اولویت</label>
                            <select class="form-select text-white" name="priority" id="formPriority">
                                <option selected>این وظیفه چقدر مهم است؟</option>
                                <option value="1" class="bc-darkBlue">کم</option>
                                <option value="2" class="bc-darkBlue">معمولی</option>
                                <option value="3" class="bc-darkBlue">زیاد</option>
                            </select>
                            <span class="text-danger" asp-validation-for="@Model.Tasks.Priority"></span>
                        </div>

                        @{
                            Model.isUserLogin();
                        }

                        <div class="mb-3">
                            <label for="formAssignee" class="form-label">اختصاص یافه به</label>
                            <div class="d-flex align-items-center mb-1">
                                <img src="@Model.loggedInUser.ImageName" class="ms-2" width="50" height="50" alt="">
                                <input type="text" class="form-control border-0 tc-lightBlue fs-5 py-2" name="assignTo" value="@Model.loggedInUser.FullName" data-id="@Model.loggedInUser.Id" disabled>
                            </div>

                            <a class="btn bc-primary rounded-bottom-0 d-block" data-bs-toggle="collapse" href="#multiCollapseExample1" role="button" aria-expanded="false" aria-controls="multiCollapseExample1">انتخاب مسئول</a>
                            <div class="row mb-3">
                                <div class="col">
                                    <div class="collapse multi-collapse" id="multiCollapseExample1">
                                        <div class="card card-body bc-primary tc-lightCyan rounded-top-0">
                                            @{
                                                <div class="form-check form-check-reverse d-flex align-items-center">
                                                    <input class="form-check-input bc-secondary hc-fs-paragraph2 ms-2" checked type="checkbox" value="@Model.loggedInUser.Id" name="Employees" id="employeeCheck@item.Id">
                                                    <label class="form-check-label w-100 hc-fs-paragraph3" for="employeeCheck@item.Id">
                                                        @Model.loggedInUser.FullName
                                                    </label>
                                                </div>
                                            }
                                            @foreach (var item in Model.EmployeesList)
                                            {
                                                <div class="form-check form-check-reverse d-flex align-items-center">
                                                    <input class="form-check-input bc-secondary hc-fs-paragraph2 ms-2" type="checkbox" value="@item.Id" name="Employees" id="employeeCheck@item.Id">
                                                    <label class="form-check-label w-100 hc-fs-paragraph3" for="employeeCheck@item.Id">
                                                        @item.FullName
                                                    </label>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <span class="text-danger" asp-validation-for="@Model.Tasks.Assignto"></span>
                        </div>

                        <div class="mb-3">
                            <label for="formAssignee" class="form-label">پروژه</label>
                            <div class="d-flex align-items-center mb-1">
                                <input type="text" class="form-control border-0 tc-lightBlue fs-5 py-2" id="txtProject" name="project" value="@Model.ProjectsList[0].Title" data-id="@Model.ProjectsList[0].Id" disabled>
                            </div>

                            <a class="btn bc-primary rounded-bottom-0 d-block" data-bs-toggle="collapse" href="#multiCollapseExample2" role="button" aria-expanded="false" aria-controls="multiCollapseExample1">انتخاب پروژه</a>
                            <div class="row mb-3">
                                <div class="col">
                                    <div class="collapse multi-collapse" id="multiCollapseExample2">
                                        <div class="card card-body bc-primary tc-lightCyan rounded-top-0">
                                            @foreach (var item in Model.ProjectsList)
                                            {
                                                <div class="form-check form-check-reverse d-flex align-items-center">
                                                    <label class="form-check-label w-100 hc-fs-paragraph3 border py-2" for="employeeCheck@item.Id">
                                                        @item.Title
                                                    </label>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <span class="text-danger" asp-validation-for="@Model.Tasks.Project"></span>
                        </div>

                        <div class="mb-3">
                            <label for="workReport" class="form-label">گزارش کار</label>
                            <div class="w-100 p-2 border border-light rounded-3">
                                <div class="row">
                                    <div class="col">
                                        <label for="estimatedTime" class="form-label hc-fs-paragraph2">زمان تخمینی</label>
                                        <input type="text" class="form-control border-0 tc-lightBlue fs-6 py-2" id="estimatedTime" name="estimateTime" placeholder="3h 30m">
                                        <span class="text-danger" asp-validation-for="@Model.Tasks.EstimateTime"></span>
                                    </div>
                                    <div class="col">
                                        <label for="remainingTime" class="form-label hc-fs-paragraph2">زمان باقی مانده</label>
                                        <input type="text" class="form-control border-0 tc-lightBlue fs-6 py-2" id="remainingTime" name="remainingTime" placeholder="1h">
                                        <span class="text-danger" asp-validation-for="@Model.Tasks.RemainingTime"></span>
                                    </div>
                                    <div class="col">
                                        <label for="loggedTime" class="form-label hc-fs-paragraph2">زمان ثبت شده</label>
                                        <input type="text" class="form-control border-0 tc-lightBlue fs-6 py-2" id="loggedTime" name="loggedTime" placeholder="2h 30m">
                                        <span class="text-danger" asp-validation-for="@Model.Tasks.LoggedTime"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="taskDescription" class="form-label">توضیحات</label>
                            <textarea class="form-control border-0 tc-lightBlue fs-6 py-2" id="taskDescription" name="description" rows="3"></textarea>
                            <span class="text-danger" asp-validation-for="@Model.Tasks.Description"></span>
                        </div>

                        <div class="modal-footer bc-lightCyan">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                انصراف
                            </button>
                            <button type="submit" class="btn btn-success">
                                افزودن وظیفه جدید
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>




    <!-- JQuery Script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


    <!-- Fontawesome Script -->
    <script src="https://kit.fontawesome.com/a904a1b9c2.js" crossorigin="anonymous"></script>

    <!-- Toastr Script -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js" crossorigin="anonymous"></script>

    <!-- Bootstrap Scripts v5.3 -->
    @{
        string popperjsUrl = "https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js";
    }
    <script src="@popperjsUrl"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
            integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
            crossorigin="anonymous"></script>

    <!-- Custom Script -->
    <script src="/src/JS/userPanel.js"></script>

    <script>

    </script>
</body>

</html>